#include <Led.h>
#include <stdio.h>

extern TIM_HandleTypeDef htim2;

void Led_init(Led* led , GPIO_TypeDef* GPIOx , uint16_t GPIO_Pin)
{
	led->state = STATE_OFF;
	led->counter = 0 ;
	led->GPIOx = GPIOx;
	led->GPIO_Pin = GPIO_Pin;
	led->delay = 0;
}


void Led_setBrightness(char param)
{
	int brightness= atoi (param);
	if(brightness > 10 || brightness < 0 )
	{
		printf("Invalid command\r\n");
		return;
	}

	__HAL_TIM_SET_COMPARE(&htim2, TIM_CHANNEL_1, brightness*10);
	HAL_TIM_Base_Start_IT(&htim2);
	HAL_TIM_PWM_Start_IT(&htim2, TIM_CHANNEL_1);
}

void Entry_blinkTask(void *obj)
{
  /* USER CODE BEGIN Entry_blinkTask */
  /* Infinite loop */
  for(;;)
  {
	  Led *led = (Led*)obj;
	  HAL_GPIO_TogglePin(led->GPIOx, led->GPIO_Pin);
	  osDelay(led->delay);
  }
  /* USER CODE END Entry_blinkTask */
}
